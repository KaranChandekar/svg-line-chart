// @format
import http from "http";
import fs from "fs";
import htm from "htm";
import vhtml from "vhtml";

const html = htm.bind(vhtml);

import { polyline, scaleDates, scalePoints } from "../src/index.mjs";

let range =
  '["2021-01-01T00:00:00.000Z","2021-01-02T00:00:00.000Z","2021-01-03T00:00:00.000Z","2021-01-04T00:00:00.000Z","2021-01-05T00:00:00.000Z","2021-01-06T00:00:00.000Z","2021-01-07T00:00:00.000Z","2021-01-08T00:00:00.000Z","2021-01-09T00:00:00.000Z","2021-01-10T00:00:00.000Z","2021-01-11T00:00:00.000Z","2021-01-12T00:00:00.000Z","2021-01-13T00:00:00.000Z","2021-01-14T00:00:00.000Z","2021-01-15T00:00:00.000Z","2021-01-16T00:00:00.000Z","2021-01-17T00:00:00.000Z","2021-01-18T00:00:00.000Z","2021-01-19T00:00:00.000Z","2021-01-20T00:00:00.000Z","2021-01-21T00:00:00.000Z","2021-01-22T00:00:00.000Z","2021-01-23T00:00:00.000Z","2021-01-24T00:00:00.000Z","2021-01-25T00:00:00.000Z","2021-01-26T00:00:00.000Z","2021-01-27T00:00:00.000Z","2021-01-28T00:00:00.000Z","2021-01-29T00:00:00.000Z","2021-01-30T00:00:00.000Z","2021-01-31T00:00:00.000Z","2021-02-01T00:00:00.000Z","2021-02-02T00:00:00.000Z","2021-02-03T00:00:00.000Z","2021-02-04T00:00:00.000Z","2021-02-05T00:00:00.000Z","2021-02-06T00:00:00.000Z","2021-02-07T00:00:00.000Z","2021-02-08T00:00:00.000Z","2021-02-09T00:00:00.000Z","2021-02-10T00:00:00.000Z","2021-02-11T00:00:00.000Z","2021-02-13T00:00:00.000Z","2021-02-14T00:00:00.000Z","2021-02-15T00:00:00.000Z","2021-02-16T00:00:00.000Z","2021-02-17T00:00:00.000Z","2021-02-18T00:00:00.000Z","2021-02-19T00:00:00.000Z","2021-02-20T00:00:00.000Z","2021-02-21T00:00:00.000Z","2021-02-22T00:00:00.000Z","2021-02-23T00:00:00.000Z","2021-02-24T00:00:00.000Z","2021-02-25T00:00:00.000Z","2021-02-26T00:00:00.000Z","2021-02-27T00:00:00.000Z","2021-02-28T00:00:00.000Z","2021-03-01T00:00:00.000Z","2021-03-02T00:00:00.000Z","2021-03-03T00:00:00.000Z","2021-03-04T00:00:00.000Z","2021-03-05T00:00:00.000Z","2021-03-06T00:00:00.000Z","2021-03-07T00:00:00.000Z","2021-03-08T00:00:00.000Z","2021-03-09T00:00:00.000Z","2021-03-10T00:00:00.000Z","2021-03-11T00:00:00.000Z","2021-03-12T00:00:00.000Z","2021-03-13T00:00:00.000Z","2021-03-14T00:00:00.000Z","2021-03-15T00:00:00.000Z","2021-03-16T00:00:00.000Z","2021-03-17T00:00:00.000Z","2021-03-18T00:00:00.000Z","2021-03-19T00:00:00.000Z","2021-03-20T00:00:00.000Z","2021-03-21T00:00:00.000Z","2021-03-22T00:00:00.000Z","2021-03-23T00:00:00.000Z","2021-03-24T00:00:00.000Z","2021-03-25T00:00:00.000Z","2021-03-26T00:00:00.000Z","2021-03-27T00:00:00.000Z","2021-03-28T00:00:00.000Z","2021-03-28T23:00:00.000Z","2021-03-29T23:00:00.000Z","2021-03-30T23:00:00.000Z","2021-03-31T23:00:00.000Z","2021-04-01T23:00:00.000Z","2021-04-02T23:00:00.000Z","2021-04-03T23:00:00.000Z","2021-04-04T23:00:00.000Z","2021-04-05T23:00:00.000Z","2021-04-06T23:00:00.000Z","2021-04-07T23:00:00.000Z"]';
range = JSON.parse(range);
range = range.map(d => new Date(d));

let data =
  "[100,94.0088401595689,110.89900250417467,107.48770059157829,113.9834374907878,110.42666806570557,112.87650979276478,107.91553217510587,110.4412552428142,97.80723164593503,85.10478716392153,86.73916123729353,95.77396648967799,97.12199422346174,107.6715253694745,119.0431329933323,127.31123821713243,123.52173751116159,132.91551725065244,133.40447378414112,106.70770268293789,114.08061885591005,117.99281615666378,122.58863698691746,137.24177127792836,134.6371024548428,118.81164540159303,126.02273031589723,126.18029940331482,126.05079116835893,122.6714615970897,129.12001864438105,127.4012581411306,138.87159934256763,144.0455274279658,154.86627105862254,149.58565277527345,147.19068780132426,163.29031676806636,182.9305006962618,201.53709751189277,249.75533511367226,214.3411658790309,205.3311879528434,184.51405738478744,188.6374326374637,199.66514833806738,217.0180845961886,205.2197918399867,216.5060430950026,231.43458047094592,201.84138848237407,165.37843389192886,174.5843231949649,170.65171328417264,156.0385429372132,155.81205832637048,174.21423098867447,161.23417182226518,181.94496495147,207.30700739298325,211.77010284549095,210.56516427734294,210.4256056330598,250.2532066937803,279.1177562140575,277.6261256622421,277.5715903441321,251.25819444416882,251.61539047766883,264.9582324289546,292.271101939443,310.64335857829246,297.8287909464649,295.3673959799652,297.471941991803,291.8364249666354,318.14288361503395,303.6155893122299,339.3187826340059,305.68960341834645,293.2631967753243,262.3195339030227,252.4206835670596,294.4907974949029,289.90461781188736,289.90461781188736,304.12584369195366,329.39891132176757,322.3614140725478,301.58509220170777,306.06990227956675,306.2358468255532,301.75857024289894,331.9936940232112,355.53023918300823,346.1924662410361]";
data = JSON.parse(data);

http
  .createServer((req, res) => {
    const width = 70;
    const height = 35;
    const x = scaleDates(width, range);
    const y = scalePoints(height, data);
    const l = polyline(x, y, { strokeWidth: 0.1 });
    res.writeHead(200, { "Content-Type": "text/html" });

    res.end(html`
      <svg viewBox="0 0 ${width} ${height}">
        ${l}
      </svg>
    `);
  })
  .listen(5000);
